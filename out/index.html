<!DOCTYPE html>
<html>
    <head>
        <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300&display=swap" rel="stylesheet"> 
        <style>
            body>div {
                margin-bottom: 5px;
            }

            #template {
                display: none;
            }

            #template, .user {
                background-color: rgb(0, 0, 145);
            }

           .user, #newUser {
                border: 2px solid lightblue;

                overflow: hidden;
                height: 11.3vh;

                padding: 5px;
                max-width: 300px;

                animation: appear .8s;
            }


            @keyframes appear {
                from {
                    height: 0vh;
                }

                to {
                    height: 11.3vh;
                }
            }

            .error {
                color: rgb(156, 0, 0);
            }


            #users {
                color: rgb(218, 218, 218);
                font-size: 1.5em;
                font-family: 'Mukta', sans-serif;
            }

            #users p {
                margin-top: 5px;
                margin-bottom: 5px;
            }
        </style>
        
        <script src="biobitmodel.js"></script>
        <script src="main.js"></script>

        <script>

            const model = new BioBitModel();
            model.addUser('ZwergB')

            function websiteRefresher() {
                
                model.start();
                requestAnimationFrame(nextFrame);
                
                function nextFrame() {

                    const users = model.users;
                    checkInterface(users);

                    refreshInterface(users);

                    requestAnimationFrame(nextFrame);
                }

                //Checks if there is an interface element for everyuser in the model
                function checkInterface(users) {
                    if (users.length > document.getElementsByClassName('user').length) {

                        for (let i = 0; i < users.length; i++) {
                            const usersNode = document.getElementById('users');
                            
                            if(!document.getElementById(users[i].id)) {
                                const template = document.getElementById('template').cloneNode(true);
                                template.id = users[i].id;
                                template.classList.add('user');
                                usersNode.appendChild(template);
                            }
                        }
                    }
                }

                function refreshInterface(users) {
                    for (let i = 0; i < users.length; i++) {
                        const user = users[i];
                        const userNode = document.getElementById(user.id);
                        
                        userNode.querySelector('.name').innerText  = user.getName();
                        userNode.querySelector('.count').innerText = user.getCount().toFixed(2);
                        userNode.querySelector('.gain').innerText  = user.getGain();
                        
                    }
                }
            }

            //

            function addNewUser() {
                const name = document.getElementById('newUserName').value;
                const err = model.addUser(name);

                document.getElementById('newUserErr').innerText = err;
            }

            
        </script>
    </head>
    <body>
        <div id="users">


            <div id="template">
                <div></div>
                <div></div>

                <p>
                    Name: <span class="name"></span>
                </p>
                <p>
                    BioBits: <span class="count"></span>
                </p>
                <p>
                    Gain/Min: <span class="gain"></span>
                </p>
            </div>

        </div>

        <div id="newUser">
            <div>
                <p>Create new User:</p>
                <input id="newUserName" placeholder="username">
                <button onclick="addNewUser()">Create</button>
                <p id="newUserErr" class="error"></p>
            </div>
        </div>

    </body>


    <script>
        websiteRefresher();
    </script>
</html>
